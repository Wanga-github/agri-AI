{% extends "base.html" %}

{% block title %}Predict Yield - AgriYield AI{% endblock %}

{% block content %}
<div class="container">
    <div class="mb-5">
        <h2 style="font-weight: 700; font-size: 2.5rem;">
            <i class="fas fa-magic" style="color: var(--primary);"></i> Yield Prediction
        </h2>
        <p style="color: var(--text-secondary); font-size: 1.1rem;">
            Enter your agricultural parameters to get AI-powered yield forecasts
        </p>
    </div>

    <div class="row g-4">
        <div class="col-lg-6">
            <div class="glass" style="padding: 2.5rem;">
                <h5 style="margin-bottom: 2rem; font-weight: 600;">Input Parameters</h5>
                
                <form method="POST" action="{{ url_for('dashboard.predict_page') }}" id="predictionForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-temperature-high"></i> Temperature (Â°C)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="temperature_avg" required value="{{ input_data.temperature_avg if input_data else 25 }}" placeholder="e.g., 25.5">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-cloud-rain"></i> Rainfall (mm)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="rainfall_mm" required value="{{ input_data.rainfall_mm if input_data else 800 }}" placeholder="e.g., 800">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-tint"></i> Humidity (%)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="humidity_percent" required value="{{ input_data.humidity_percent if input_data else 65 }}" placeholder="e.g., 65">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-flask"></i> Soil pH
                                </label>
                                <input type="number" step="0.01" class="form-control" name="soil_ph" required value="{{ input_data.soil_ph if input_data else 6.5 }}" placeholder="e.g., 6.5">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-leaf"></i> Nitrogen (kg/ha)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="soil_nitrogen" required value="{{ input_data.soil_nitrogen if input_data else 20 }}" placeholder="e.g., 20">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-leaf"></i> Phosphorus (kg/ha)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="soil_phosphorus" required value="{{ input_data.soil_phosphorus if input_data else 15 }}" placeholder="e.g., 15">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-leaf"></i> Potassium (kg/ha)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="soil_potassium" required value="{{ input_data.soil_potassium if input_data else 18 }}" placeholder="e.g., 18">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-seedling"></i> Fertilizer (kg)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="fertilizer_used_kg" required value="{{ input_data.fertilizer_used_kg if input_data else 100 }}" placeholder="e.g., 100">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-water"></i> Irrigation (hours)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="irrigation_hours" required value="{{ input_data.irrigation_hours if input_data else 200 }}" placeholder="e.g., 200">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-map"></i> Area (hectares)
                                </label>
                                <input type="number" step="0.01" class="form-control" name="area_hectares" required value="{{ input_data.area_hectares if input_data else 5 }}" placeholder="e.g., 5">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 mt-4" style="padding: 1rem;">
                        <i class="fas fa-rocket"></i> Generate Prediction
                    </button>
                </form>
            </div>
        </div>
        
        <div class="col-lg-6">
            {% if result %}
            <div class="glass result-card" style="position: sticky; top: 100px;">
                <div style="text-align: center;">
                    <div style="display: inline-block; padding: 0.5rem 1.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 50px; margin-bottom: 1rem;">
                        <span style="color: var(--primary); font-weight: 600; font-size: 0.9rem;">
                            <i class="fas fa-check-circle"></i> Prediction Complete
                        </span>
                    </div>
                    
                    <h4 style="color: var(--text-secondary); font-weight: 500; margin-bottom: 0.5rem;">Predicted Yield</h4>
                    <div class="result-value">{{ result.predicted_yield }}</div>
                    <p style="color: var(--text-secondary); font-size: 1.1rem; margin-top: -0.5rem;">tons per hectare</p>
                    
                    <div style="margin: 2rem 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary); font-size: 0.9rem;">Confidence Score</span>
                            <span style="color: var(--primary); font-weight: 600;">{{ result.confidence_score }}%</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: {{ result.confidence_score }}%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
                            <span>{{ result.confidence_interval.lower }} t/ha</span>
                            <span>{{ result.confidence_interval.upper }} t/ha</span>
                        </div>
                    </div>
                </div>
                
                {% if result.recommendations %}
                <div style="margin-top: 2.5rem;">
                    <h5 style="font-weight: 600; margin-bottom: 1.5rem;">
                        <i class="fas fa-lightbulb" style="color: var(--primary);"></i> Recommendations
                    </h5>
                    {% for rec in result.recommendations %}
                    <div class="recommendation priority-{{ rec.priority }}">
                        <div style="display: flex; align-items: start; gap: 1rem;">
                            <div class="recommendation-icon">
                                {% if rec.type == 'irrigation' %}
                                <i class="fas fa-water"></i>
                                {% elif rec.type == 'fertilizer' %}
                                <i class="fas fa-seedling"></i>
                                {% elif rec.type == 'soil_management' %}
                                <i class="fas fa-flask"></i>
                                {% else %}
                                <i class="fas fa-chart-line"></i>
                                {% endif %}
                            </div>
                            <div class="recommendation-content" style="flex: 1;">
                                <h6 style="margin: 0;">{{ rec.type|replace('_', ' ')|title }}</h6>
                                <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem;">{{ rec.message }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% elif error %}
            <div class="glass" style="padding: 3rem; text-align: center;">
                <div style="width: 80px; height: 80px; background: rgba(239, 68, 68, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #ef4444;"></i>
                </div>
                <h5 style="color: var(--text); margin-bottom: 1rem;">Prediction Error</h5>
                <p style="color: var(--text-secondary);">{{ error }}</p>
                <button onclick="location.reload()" class="btn btn-outline" style="margin-top: 1rem;">
                    <i class="fas fa-redo"></i> Try Again
                </button>
            </div>
            {% else %}
            <div class="glass" style="padding: 3rem; text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: center; position: sticky; top: 100px;">
                <div style="width: 100px; height: 100px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                    <i class="fas fa-arrow-left" style="font-size: 2.5rem; color: var(--primary);"></i>
                </div>
                <h5 style="color: var(--text); margin-bottom: 1rem;">Ready for Prediction</h5>
                <p style="color: var(--text-secondary);">Fill in the parameters on the left and click "Generate Prediction" to see AI-powered yield forecasts.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('predictionForm');
    
    form.addEventListener('submit', function(e) {
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<span class="loading"></span> Processing...';
        submitBtn.disabled = true;
    });
    
    // Animate confidence bar on load
    {% if result %}
    setTimeout(() => {
        const confidenceFill = document.querySelector('.confidence-fill');
        if (confidenceFill) {
            confidenceFill.style.width = '{{ result.confidence_score }}%';
        }
    }, 300);
    {% endif %}
});
</script>
{% endblock %}